# Containerless
## 컨테이너리스 웹 애플리케이션 아키텍처

스프링부트는 컨테이너리스 웹 애플리케이션 아키텍처를 스프링이 지원해줬으면 좋겠다고 한 한 개발자의 요청 사항으로부터 출발.
그럼 컨테이너리스가 뭘까? 
컨테이너가 필요없다는게 아닌, `Serverless` 와 유사하다. 서버에 대한 설치, 관리를 개발자들이 신경 쓰지 않고
서버 애플리케이션을 개발하고 배포해 운영이 가능하도록 하는게 Serverless 라고 하는데, Containerless 도 이와 유사.

그럼 컨테이너 관리를 신경 쓰지 않아도 된다라는 이야기를 하려면, 먼저 컨테이너가 뭔지를 따져봐야 한다.
스프링은 IOC 컨테이너이다. 스프링 컨테이너라고 부르기도. 

웹 프로그램을 개발한다는 건 서버에서 동작하면서 기능을 제공해주는 여러가지 컴포넌트를 만드는 것이다.
웹 컴포넌트 하나를 만들었다 가정하다. 예를 들어 회원가입을 담당하는 웹 컴포넌트를 만들었다.
이 웹 컴포넌트는 서버에 존재하게 될텐데, 혼자서는 일을 하지 못한다.
웹 컴포넌트는 앞에 항상 웹 클라이언트가 필요하다. 웹 클라이언트가 요청을 주면 그때 웹 컴포넌트가 일을 하는 것.

웹 컴포넌트의 핵심 목적은 다이나믹 컨텐트를 만드는 것이다. 우리가 만약 다이나믹하게 매번 바뀌는 컨텐트가 아닌
항상 고정된 페이지를 띄운다면 굳이 웹 컴포넌트를 만들 필요 없이 웹 서버 위에 정적 리소스를 올려놓으면 된다.
하지만 웹 컴포넌트를 만들고 코드를 작성한다는 건 동적인 컨텐츠를 만들어서 다시 웹 클라이언트한테 응답으로 보내주는 것.
따라서 웹은 항상 요청과 응답 쌍으로 돌아가게 되어있고 또 요청을 처리하는 하나 이상의 웹 컴포넌트가 존재하고
그 웹 컴포넌트가 하는 주요한 일은 다이나믹 컨텐트를 만드는 일이다.

그런데 웹 컴포넌트는 이렇게 혼자 있을 수 없다. 항상 웹 컴포넌트는 웹 컨테이너 안에 들어가 있어야 한다.
그렇다면 웹 컨테이너는 뭘까? 웹 컨테이너란 1차적으로 웹 컴포넌트를 관리하는 역할을 한다.
웹 컴포넌트가 서버에 떠있으므로 누군가가 시작을 시켜줘야 한다.
컴포넌트를 메모리에 올리고 new 해서 진입되는 인스턴스를 생성해주고 서비스가 되는 동안 계속 메모리 위에서 관리해주는 작업이 필요하다.
흔히 이야기하는 라이프 사이클을 관리하는게 웹 컨테이너의 주요한 역할 첫 번째이다.

또 하나 중요한 건 웹 컨테이너는 일반적으로 하나의 웹 컴포넌트만 갖고 관리하지 않는다.
이 안에는 하나의 웹 컨테이너가 제공하는 서비스를 담당하는 굉장히 많은 종류의 컴포넌트를 여러 개 가지고 있을 수 있다.
이렇게 많은 기능을 가진 여러 개의 컴포넌트들을 웹 컨테이너가 관리를 해줘야 한다.

또 웹 컨테이너가 해주는 중요한 일 중 하나는 클라이언트로부터 들어온 요청은 어느 컴포넌트가 관리할 것인지
결정해 연결해주는 작업이 필요하다. 웹 요청이 들어오면 웹 컨테이너는 정해진 룰에 따라 어느 컴포넌트가 요청을 처리해줄지
컴포넌트에게 요청을 넘겨준다. 어떤 컴포넌트가 웹 요청을 처리할지 결정하고 선택하는 작업을 흔히 라우팅, 매핑이라고 한다. (ex. 핸들러 매핑)

<img width="870" src="https://github.com/al1kite/Dev-Books-wiki/assets/102217402/6ea546f7-819c-431e-85c2-f3d70886b809">

이걸 자바 용어로 바꿔보겠다.

자바에서는 웹 컴포넌트를 서블릿이라 부른다. 우리가 잘 아는 서블릿이 웹 컴포넌트이다.
또 이 서블릿을 관리해주는 컨테이너가 서블릿 컨테이너라 부른다. 톰켓 같은 거.
이 안에 서블릿을 여러 개 띄워놓고 매핑 정보를 넣으면 특정 서블릿이 그 요청을 처리할 수 있도록
그리고 응답을 생성해 다시 클라이언트, 브라우저나 API 호출을 생성한 클라이언트한테 돌려주는 작업을 담당하는
서블릿 컨테이너가 존재한다. 이게 원래 전통적인 90년대 후반부터 시작된 자바의 프로그래밍 가장 기본 구성이 되는 것.

서블릿에 대해 불만을 많이 가진 사람들이 만든 것이 우리가 공부하는 스프링 프레임워크다.
스프링이란, 아까 스프링 컨테이너라 언급했는데, 그렇다고 서블릿 컨테이너를 대체하는 건 아니다. 
이때 스프링 컨테이너에 들어가는 컴포넌트들을 빈 (BEAN) 이라 부른다. 자바 빈에서의 용어를 따옴.
여러 개의 빈을 가진 스프링 컨테이너가 서블릿 컨테이너 뒷쪽에서 서블릿을 통해 웹으로 들어오는 요청을 받아 
스프링 컨테이너에게 다시 넘겨주는 것. 스프링 컨테이너가 이건 어느 빈이 이 요청을 처리해라, 작업하는 동안 이런 기능이 필요하니
이 작업이 필요하다 다시 호출하기도 하고, 스프링 컨테이너 안에서 우리가 만든 애플리케이션이 동작하는 것.

<img width="495" src="https://github.com/al1kite/Dev-Books-wiki/assets/102217402/7f949059-dfed-4d61-8b3f-31e60e939ae6">

그럼 스프링 컨테이너가 서블릿 컨테이너를 대체하면 안 될까? 하면 안된다.
기본적으로 자바의 표준 웹 기술을 사용하려면 어쨌건 서블릿 컨테이너가 존재해야한다.
스프링으로 애플리케이션 개발하는 것만 집중해 저 빈을 어떻게 구성하고 이를 스프링 컨테이너에 어떻게 담을지 등만 고민하고 개발하면 좋겠는데
이걸 동작하려면 무조건 서블릿 컨테이너가 떠야 한다. 근데 이 서블릿 컨테이너를 띄우는게 간단하지 않다.
이게 오래된 기술이기도 하고 많은 걸 포용하려 여러 다양한 설정방법을 요구하고 있다.

`web.xml` 을 봤을텐데, 스프링 프로젝트를 만들려면 이를 작성해야했다. 이게 들어가야만 서블릿 컨테이너가 뜨고
그 서블릿 컨테이너를 통해 스프링 컨테이너가 호출됐던 것. xml 복잡한데다가 프로젝트 한 번 셋업할 때 보고 그 이후에 거의 들여다 보지 않는다.

그렇다고 이거 하나만 집어넣으면 서블릿 컨테이너가 다 되면 좋은데 그게 아니다.
서블릿 컨테이너, 스프링 컨테이너까지 포함해서 이 전체 서블릿 컨테이너 위에 돌아가는 애플리케이션은 확장자가 WAR인 파일로 빌드가 되어야 하고
폴더 구조도 중요하다. web/inf/.. class 어디에.. jar 라이브러리는 어디에.. 등 이걸 맞춰 프로젝트 폴더 구성도 해야한다.
이게 전부가 아닌 이렇게 준비가 되었어도 실제로 서블렛 컨테이너는 완전히 독립적인 서버 프로그램이다.
톰캣 같은 걸 우리가 받아서 우리 환경에 맞게 설치 및 실행을 시켜야 한다. 또 WAR 파일로 압축되어 있는 우리의 애플리케이션을 배포하는 작업도 필요하다.
배포 방식도 되게 다양하고 문제를 해결할 줄도 알아야 한다. 또 서블릿 컨테이너 설정도 알아야 한다. 클래스 로더, 로깅 등등..
이런 많은 정보들을 우리가 단순히 스프링 컨테이너에 들어가는 애플리케이션을 만든다 하더라도 항상 이를 설치 및 실행하기 위해선
꼭 필요하지만 사실 그렇게 중요하지 않은, 우리가 개발하는 동안 신경써야 되는게 아닌 내용을 알고 있어야 한다.

더 큰 문제는 서블릿 컨테이터는 하나만 있는게 아닌, 서블릿 컨테이너는 표준 스펙이고 이를 구현한 제품(ex. 톰캣)을 사용해야 하는데
다른 종류의 서블릿 컨테이너를 쓴다면 그 서블릿 컨테이너에는 web.xml과 WAR 형식이 말고 그 외 설치와 배포 및 설정 방식을 사용할 수 있다.
톰캣도 버전마다 다름. 따라서 학습 곡선은 높지만 그다지 학습해서 유용하지 않다.

그래서 서블릿 컨테이너가 없는, 컨테이너리스 웹 아키텍처를 만들어줬으면 좋겠다 하는 건
서블릿 컨테이너를 안쓰고 스프링 컨테이너가 웹 요청을 받았으면 하는게 아닌
서블릿 컨테이너가 필요는 하고 동작해야 하지만 이를 설치, 관리하는 건 너무 신경 쓸 게 많으니 
이런 수고 없이 할 수 있으면 좋겠다.

<img width="496" src="https://github.com/al1kite/Dev-Books-wiki/assets/102217402/18524fb2-2ef4-49d3-8616-2351b0c62ac3">

컨테이너리스가 동작하면 이렇게 된다. 실제로는 Servlet 컨테이너가 동작한다.
거기에 web.xml 이나 혹은 요즘에 web.xml에 대응되는 Java 코드를 작성하는 방법도 있는데
이런 것들은 다 알아서 스프링부트를 통해서 제공된다. 

이에 대한 설정을 우리가 하나도 신경 쓰지 않고 일단 개발을 시작하고 서버를 띄우고 동작할 수 있다.
물론 나중에 원하면 이 Servlet Container를 굉장히 깊이 있게 살펴보고 
원하는 방식으로 튜닝하거나 커스터마이징 할 수 있다.

어쨌거나 몰라도 스프링을 개발하는 데에는 저런 걸 작성하고 빈으로 등록하면 된다는 걸 안다면
바로 웹 환경에서 동작하는 스프링 애플리케이션을 만들고 사용할 수 있다.
이게 Spring Boot 가 적용한 방식이다.

흥미로운 건 아까 서블릿 컨테이너를 알려면 설치 하고 실행하는게 필요하다 했는데
아무리 다른 작업들은 디폴트 설정을 넣어주고 자동으로 한다 치더라도 어쨌든 서블릿 컨테이너가 실행해야한다.
이걸 띄우는 작업 필요하다 생각할 수 있는데 그 부분 조차 제거해버린 것.

그래서 Spring Boot 를 이용하면 어떤 클래스의 메인 메서드를 호출해주면 이 전체가 
다 동작하는 방식으로 개발할 수 있다.
이걸 독립 실행형 애플리케이션, 혹은 스탠드얼론 애플리케이션이라 부르고 실제로 코드를 만들어보면
Spring Boot 에는 항상 메인 메서드가 등장한다.
그것만으로도 Servlet Container와 관련된 모든 필요한 작업들이 다 수행이 되는 것.
